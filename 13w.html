<html>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
    <title>十三水•Chinese Poker</title>
    <style>
h1 {
  color: brown;
  font-size: 40px;
}
h2 {
  color: brown;
  font-size: 30px;
}
td.menu {
  font-size: 20px;
}
button.menu {
  font-size: 20px;
}
button.move {
  font-size: 30px;
}
td.move {
  text-align: center;
}
td.pattern {
  color: darkblue;
  font-size: 20px;
  text-align: center;
}
table.hand {
  background-color: green;
  border-radius: 5px;
  padding: 2px;
}
table.card {
  background-color: white;
  border-radius: 5px;
  padding: 0px;
  text-align: center;
  width: 60px;
}
td.rank {
  font-size: 30px;
}
td.suit {
  font-size: 25px;
}
    </style>
    <script>
var suit_symbols = [
  '<font color="black">♠</font>',
  '<font color="red">♥</font>',
  '<font color="black">♣</font>',
  '<font color="red">♦</font>',
];
var rank_symbols = [
  '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A' ];
var Two = 0, Three = 1, Four = 2, Five = 3, Six = 4, Seven = 5, Eight = 6,
    Nine = 7, Ten = 8, Jack = 9, Queen = 10, King = 11, Ace = 12;

var pattern_symbols = [
    'junk', 'pair', 'two pairs', 'triple', 'straight',
    'flush', 'full house', 'quadruple', 'straight flush'
];
var Junk = 0, Pair = 1, TwoPairs = 2, Triple = 3, Straight = 4,
    Flush = 5, FullHouse = 6, Quadruple = 7, StraightFlush = 8;

var Front = 0, Center = 1, Back = 2;

var ai_hand = [], hand = [];
var ai_total_points = 0, total_points = 0;
var sorted_by = '';
var wave_sizes = { front: 3, center: 5, back: 5 };
var wave_values = { front: 0, center: 0, back: 0 };
var waves = { front: [], center: [], back: [] };
var membership = {};
var active_wave = 'front';
var saved_waves = [];

function suit(card) { return Math.floor(card / 13); }
function rank(card) { return card % 13; }

function deal_hand() {
  var deck = [];
  for (var i = 0; i < 52; ++i) {
    deck.push(i);
  }
  for (var i = 0; i < 52; ++i) {
    var pos = Math.floor(Math.random() * (52 - i));
    var card = deck[pos];
    deck[pos] = deck[51 - i];
    deck[51 - i] = card;
  }

  ai_hand = deck.slice(0, 13);
  for (var name in waves) {
    for (var index in waves[name]) {
      clear_card('ai_' + name + '_', index, waves[name][index]);
    }
  }

  hand = deck.slice(13, 26);
  sort_hand();
  membership = {};
  for (var name in waves) {
    waves[name] = [];
    redraw_wave(name);
  }
  redraw_hand();
  saved_waves = [];
  set_inner_html('load_area', '');
  document.getElementById('deal').style.display = 'none'
  document.getElementById('show').style.display = 'inline'
  document.getElementById('load').style.visibility = 'hidden';
}

function sort_hand() {
  if (sorted_by == 'suit') {
    hand.sort(function(a, b) { return rank(a) - rank(b); });
    sorted_by = 'rank';
    set_inner_html('sort', 'Sort by suit');
  } else {
    hand.sort(function(a, b) {
      return suit(a) == suit(b) ? rank(a) - rank(b) : suit(a) - suit(b);
    });
    sorted_by = 'suit';
    set_inner_html('sort', 'Sort by rank');
  }
  redraw_hand();
}

function redraw_hand() {
  for (var i = 0; i < 13; ++i) {
    set_card('', i, hand[i]);
    if (membership[hand[i]] == null) {
      enable_card('', i);
    } else {
      disable_card('', i);
    }
  }
}

function activate_wave(name) {
  document.getElementById(active_wave).style.backgroundColor = 'green';
  document.getElementById(name).style.backgroundColor = 'orange';
  active_wave = name;
}

function move_card(index) {
  var card = hand[index];
  if (membership[card] != null) {
    var name = membership[card];
    for (var i = 0; i < waves[name].length; ++i) {
      if (waves[name][i] == card) {
        undo_card(membership[card], i);
        break;
      }
    }
    return;
  }

  disable_card('', index);
  membership[card] = active_wave;
  waves[active_wave].push(card);
  sort_wave(active_wave);

  if (waves[active_wave].length == wave_sizes[active_wave]) {
    for (var name in waves) {
      if (waves[name].length < wave_sizes[name]) {
        activate_wave(name);
        break;
      }
    }
  }
}

// Special case for 2345A.
function sort_special_straight(cards) {
  if (rank(cards[0]) == Two &&
      rank(cards[1]) == Three && rank(cards[2]) == Four &&
      rank(cards[3]) == Five && rank(cards[4]) == Ace) {
    var temp = cards[4];
    cards[4] = cards[3];
    cards[3] = cards[2];
    cards[2] = cards[1];
    cards[1] = cards[0];
    cards[0] = temp;
  }
}

function sort_wave(name) {
  var cards = waves[name];
  cards.sort(function(a, b) { return rank(a) - rank(b); });
  if (cards.length == 5) {
    sort_special_straight(cards);
  }
  redraw_wave(name);
}

function fill_wave(name) {
  activate_wave(name);
  for (var i = waves[name].length; i < wave_sizes[name]; ++i) {
    for (var j = 0; j < 13; ++j) {
      if (membership[hand[j]] == null) {
        move_card(j);
        break;
      }
    }
  }
}

function move_all_cards() {
  for (var i = 0; i < 13; ++i) {
    move_card(i);
  }
}

function undo_all_cards() {
  for (var name in waves) {
    clear_wave(name);
  }
}

function clear_wave(name) {
  for (var i = waves[name].length - 1; i >= 0; --i) {
    undo_card(name, i);
  }
  redraw_wave(name);
}

function undo_card(name, index) {
  if (waves[name].length <= index) {
    redraw_wave(name);
    return;
  }

  var card = waves[name][index];
  for (var i = 0; i < 13; ++i) {
    if (hand[i] == card) {
      enable_card('', i);
      delete membership[card];
      break;
    }
  }
  waves[name].splice(index, 1);
  redraw_wave(name);
}

function redraw_wave(name) {
  for (var i = 0; i < waves[name].length; ++i) {
    set_card(name + '_', i, waves[name][i]);
  }
  for (var i = waves[name].length; i < wave_sizes[name]; ++i) {
    clear_card(name + '_', i);
  }
  activate_wave(name);

  if (waves[name].length < wave_sizes[name]) {
    set_inner_html(name + '_pattern', '&nbsp;');
    wave_values[name] = 0;
  } else {
    var order = name == 'front' ? Front : name == 'center' ? Center : Back;
    var wave = new WaveEvaluator(waves[name], order);
    set_inner_html(name + '_pattern',
                   pattern_symbols[wave.pattern] + ': ' + wave.value + '%');
    wave_values[name] = wave.value;
  }
  var sum = 0;
  for (var name in wave_values) {
    sum += wave_values[name];
  }
  set_inner_html('average', sum ? 'average: ' + Math.floor(sum / 3) + '%' : '');
}

function set_card(waves, index, card) {
  set_inner_html(waves + 'suit_' + index, suit_symbols[suit(card)]);
  set_inner_html(waves + 'rank_' + index, rank_symbols[rank(card)]);
}

function clear_card(waves, index) {
  set_inner_html(waves + 'suit_' + index, '?');
  set_inner_html(waves + 'rank_' + index, '?');
}

function enable_card(waves, index) {
  var id = waves + 'card_' + index;
  document.getElementById(id).style.backgroundColor = 'white';
}

function disable_card(waves, index) {
  var id = waves + 'card_' + index;
  document.getElementById(id).style.backgroundColor = 'lightgrey';
}

function set_inner_html(id, value) {
  document.getElementById(id).innerHTML = value;
}

function save_waves() {
  for (var name in waves) {
    if (waves[name].length < wave_sizes[name]) {
      alert('Please finish all three waves before saving them.');
      return;
    }
  }
  for (var number in saved_waves) {
    var duplicate = true;
    for (var card in membership) {
      if (membership[card] != saved_waves[number][card]) {
        duplicate = false;
        break;
      }
    }
    if (duplicate) {
      alert('Waves already saved as #' + (Number(number) + 1));
      return;
    }
  }
  var number = saved_waves.length;
  saved_waves.push({});
  for (var card in membership) {
    saved_waves[number][card] = membership[card];
  }

  var button = document.createElement('BUTTON');
  button.innerHTML = '#' + Math.floor(number + 1);
  button.className = 'menu';
  button.onclick = function() { load_waves(number) };
  document.getElementById('load').style.visibility = 'visible';
  document.getElementById('load_area').appendChild(button);
}

function load_waves(number) {
  for (var card in saved_waves[number]) {
    membership[card] = saved_waves[number][card];
  }

  for (var name in waves) {
    waves[name] = [];
  }
  for (var card in membership) {
    waves[membership[card]].push(card);
  }
  for (var name in waves) {
    sort_wave(name);
  }
  redraw_hand();
}

function show_hand() {
  for (var name in waves) {
    if (waves[name].length < wave_sizes[name]) {
      alert('Please finish all three waves before matching against AI.');
      return;
    }
  }
  var front = new WaveEvaluator(waves['front'], Front);
  var center = new WaveEvaluator(waves['center'], Center);
  var back = new WaveEvaluator(waves['back'], Back);
  if (center.is_smaller_than(front)) {
         console.log(front);
         console.log(center);
    alert('The center wave should not be smaller than the front wave.');
    return;
  }
  if (back.is_smaller_than(center)) {
    alert('The back wave should not be smaller than the center wave.');
    return;
  }

  var ai_max_waves = (new HandOptimizer(ai_hand)).waves;
  var ai_waves = {}, ai_wave_values = {};
  ai_waves['front'] = ai_max_waves.slice(0, 3);
  ai_waves['center'] = ai_max_waves.slice(3, 8);
  ai_waves['back'] = ai_max_waves.slice(8, 13);
  var points = 0, ai_points = 0;
  for (var name in ai_waves) {
    for (var index in ai_waves[name]) {
      set_card('ai_' + name + '_', index, ai_waves[name][index]);
    }
    var order = name == 'front' ? Front : name == 'center' ? Center : Back;
    var wave = name == 'front' ? front : name == 'center' ? center : back;
    var ai_wave = new WaveEvaluator(ai_waves[name], order);
    var result = '';
    if (ai_wave.is_smaller_than(wave)) {
      points += 1;
      result = 'win';
    } else if (wave.is_smaller_than(ai_wave)) {
      ai_points += 1;
      result = 'lose';
    } else {
      result = 'tie';
    }
    set_inner_html(name + '_pattern', result);
  }
  set_inner_html('average', '');

  // Double points for a sweeping win.
  if (points == 0) ai_points *= 2;
  if (ai_points == 0) points *= 2;

  set_inner_html('score', "You: " + total_points + ' +' + points);
  set_inner_html('ai_score', "AI: " + ai_total_points + ' +' + ai_points);
  total_points += points;
  ai_total_points += ai_points;

  document.getElementById('deal').style.display = 'inline'
  document.getElementById('show').style.display = 'none'
}

var junk_value = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [ 0,  0,  0,  0,  0,  1,  1,  2,  2,  4,  7, 15, 34],
  [ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1],
  [ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0]
];

var junk_value0 = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [ 0, 20, 20, 21, 21, 22, 23, 24, 26, 30, 34, 42,  0],  //A?
  [ 0,  9,  9, 10, 10, 11, 11, 12, 13, 15, 18,  0,  0],  //K?
  [ 0,  5,  5,  5,  6,  6,  7,  7,  8,  8,  0,  0,  0]   //Q?
];

var one_pair_value = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [45, 47, 49, 51, 53, 56, 60, 64, 68, 73, 81, 89, 97],
  [ 2,  3,  3,  4,  5,  6,  8, 10, 12, 15, 18, 24, 33],
  [ 0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  2,  2,  3]
];

var one_pair_value0 = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [96, 96, 96, 96, 96, 96, 97, 97, 97, 97, 98, 98,  0],  //A?
  [86, 86, 86, 86, 86, 87, 87, 88, 89, 89, 90,  0, 91],  //K?
  [76, 76, 77, 77, 77, 78, 78, 78, 79, 80,  0, 82, 83]   //Q?
];

var one_pair_value1 = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [ 0,  0, 30, 31, 31, 32, 32, 33, 33, 34, 35, 36,  0],  //A?
  [ 0,  0, 23, 23, 23, 23, 23, 24, 25, 25, 26,  0, 27],  //K?
  [ 0,  0, 17, 17, 18, 18, 18, 19, 19, 20,  0, 21, 22]   //Q?
];

var two_pair_value = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [ 0, 37, 37, 39, 41, 43, 46, 49, 54, 58, 62, 64, 64],
  [ 0,  3,  3,  4,  4,  5,  7,  8, 10, 11, 13, 14, 14]
];

var triple_value = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [99, 99, 99, 99, 99,100,100,100,100,100,100,100,100],
  [63, 66, 69, 71, 72, 72, 74, 74, 74, 75, 75, 75, 76],
  [12, 13, 13, 15, 16, 16, 16, 16, 16, 14, 15, 15, 15]
];

var straight_value = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [ 0,  0,  0, 77, 79, 81, 83, 85, 87, 88, 89, 91, 92],
  [ 0,  0,  0, 16, 18, 20, 22, 24, 26, 28, 31, 34, 37]
];

var flush_value = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [ 0,  0,  0,  0,  0, 93, 92, 92, 93, 94, 95, 97, 98],
  [ 0,  0,  0,  0,  0, 35, 37, 38, 38, 40, 44, 50, 61]
];

var flush_value2 = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [ 0,  0,  0,  0, 53, 54, 55, 56, 57, 59, 62, 65,  0],  //A?
  [ 0,  0,  0, 44, 44, 45, 46, 47, 48, 49, 52,  0,  0],  //K?
  [ 0,  0,  0, 41, 41, 41, 42, 42, 44, 45,  0,  0,  0]   //Q?
];

var full_value = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [98, 99, 99, 99, 99, 99, 99, 99,100,100,100,100,100],
  [65, 66, 69, 71, 73, 75, 78, 80, 82, 85, 88, 91, 94],
];

var quadruple_value = [
  //2   3   4   5   6   7   8   9   T   J   Q   K   A
  [ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
  [100,100,100,100,100,100,100,100,100,100,100,100,100],
  [ 94, 94, 95, 95, 95, 96, 97, 97, 97, 97, 98, 98, 98]
];

class WaveEvaluator {
  constructor(cards, order) {
    this.cards = cards.slice(0);
    this.order = order;

    this.features = [];
    this.extract_features();
    this.win_percent = this.evaluate();
  }

  extract_features() {
    this.cards.sort(function(a, b) { return rank(a) - rank(b); });

    var num_junks = 0, num_pairs = 0, num_triples = 0;
    var length = this.cards.length;
    for (var i = 0; i < length; ++i) {
      var r = rank(this.cards[i]);
      if (i + 1 >= length || r != rank(this.cards[i + 1])) {
        this.features.push({type: Junk, rank: r});
        ++num_junks;
      } else if (i + 2 >= length || r != rank(this.cards[i + 2])) {
        this.features.push({type: Pair, rank: r});
        ++num_pairs;
        i += 1;
      } else if (i + 3 >= length || r != rank(this.cards[i + 3])) {
        this.features.push({type: Triple, rank: r});
        ++num_triples;
        i += 2;
      } else {
        this.features.push({type: Quadruple, rank: r});
        i += 3;
      }
    }
    if (num_junks == 5) {
      var high_rank = rank(this.cards[4]);
      var straight = false;
      if (rank(this.cards[0]) + 4 == rank(this.cards[4])) {
        straight = true;
      }
      // Special case for 2345A.
      if (rank(this.cards[0]) == Two && rank(this.cards[3]) == Five &&
          rank(this.cards[4]) == Ace) {
        straight = true;
        high_rank = Five;
      }

      var flush = true;
      for (var i = 0; i < length - 1; ++i) {
        if (suit(this.cards[i]) != suit(this.cards[i + 1])) {
          flush = false;
          break;
        }
      }

      if (straight && flush) {
        this.features = [{type: StraightFlush, rank: high_rank}];
      } else if (straight) {
        this.features = [{type: Straight, rank: high_rank}];
      } else if (flush) {
        this.features.pop();
        this.features.push({type: Flush, rank: high_rank});
      }
    }

    this.features.sort(function(a, b) {
      return a.type == b.type ? b.rank - a.rank : b.type - a.type;
    });

    if (num_pairs == 2) {
      this.features[0].type = TwoPairs;
    }
    if (num_triples == 1 && num_pairs == 1) {
      this.features[0].type = FullHouse;
    }
  }

  evaluate() {
    var r0 = this.rank;
    switch (this.pattern) {
      case StraightFlush:
        return 100;
      case Quadruple:
        return quadruple_value[this.order][r0];
      case FullHouse:
        return full_value[this.order][r0];
      case Flush:
        var r1 = this.features[1].rank;
        if (this.order == Back && r0 >= Queen)
          return flush_value2[Ace - r0][r1];
        return flush_value[this.order][r0];
      case Straight:
        return straight_value[this.order][r0];
      case Triple:
        return triple_value[this.order][r0];
      case TwoPairs:
        return two_pair_value[this.order][r0];
      case Pair:
        var r1 = this.features[1].rank;
        if (this.order == Front && r0 >= Queen)
          return one_pair_value0[Ace - r0][r1];
        if (this.order == Center && r0 >= Queen)
          return one_pair_value1[Ace - r0][r1];
        return one_pair_value[this.order][r0];
      case Junk:
        var r1 = this.features[1].rank;
        if (this.order == Front && r0 >= Queen)
          return junk_value0[Ace - r0][r1];
        return junk_value[this.order][r0];
    }
  }

  get pattern() { return this.features[0].type; }
  get rank() { return this.features[0].rank; }
  get value() { return this.win_percent; }
  get wave() {
    // Special case for 2345A.
    if (this.pattern == Straight && this.rank == Five)
      return this.cards.slice(4, 5) + this.cards.slice(0, 4);
    return this.cards;
  }

  is_smaller_than(wave) {
    var min_features = Math.min(this.features.length, wave.features.length);
    for (var i = 0; i < min_features; ++i) {
      if (this.features[i].type < wave.features[i].type) return true;
      if (this.features[i].type > wave.features[i].type) return false;
      if (this.features[i].rank < wave.features[i].rank) return true;
      if (this.features[i].rank > wave.features[i].rank) return false;
    }
    return false;
  }
};

class HandOptimizer {
  constructor(hand) {
    this.hand = hand;

    this.optimize_waves();
  }

  optimize_waves() {
    this.hand.sort(function(a, b) { return rank(a) - rank(b); });
    this.max_value = 0;
    this.optimize_back();
  }

  optimize_back() {
    for (var b1 = 0; b1 < 9; ++b1) {
      for (var b2 = b1 + 1; b2 < 10; ++b2) {
        for (var b3 = b2 + 1; b3 < 11; ++b3) {
          for (var b4 = b3 + 1; b4 < 12; ++b4) {
            for (var b5 = b4 + 1; b5 < 13; ++b5) {
              this.back = new WaveEvaluator(
                [this.hand[b1], this.hand[b2], this.hand[b3],
                 this.hand[b4], this.hand[b5]], Back);
              if (this.back.pattern == Junk) continue;
              if (200 + this.back.value < this.max_value) continue;

              var bits = (1<<b1) + (1<<b2) + (1<<b3) + (1<<b4) + (1<<b5);
              this.optimize_center(bits);
            }
          }
        }
      }
    }
  }

  optimize_center(bits) {
    out:
    for (var c1 = 0; c1 < 9; ++c1) {
      if ((1 << c1) & bits) continue;
      for (var c2 = c1 + 1; c2 < 10; ++c2) {
        if ((1 << c2) & bits) continue;
        for (var c3 = c2 + 1; c3 < 11; ++c3) {
          if ((1 << c3) & bits) continue;
          for (var c4 = c3 + 1; c4 < 12; ++c4) {
            if ((1 << c4) & bits) continue;
            for (var c5 = c4 + 1; c5 < 13; ++c5) {
              if ((1 << c5) & bits) continue;

              this.center = new WaveEvaluator(
                [this.hand[c1], this.hand[c2], this.hand[c3],
                 this.hand[c4], this.hand[c5]], Center);
              if (this.back.is_smaller_than(this.center)) break out;
              if (100 + this.center.value + this.back.value < this.max_value)
                continue;

              var center_bits = (1<<c1) + (1<<c2) + (1<<c3) + (1<<c4) + (1<<c5);
              this.optimize_front(bits + center_bits);
            }
          }
        }
      }
    }
  }

  optimize_front(bits) {
    out:
    for (var f1 = 0; f1 < 11; ++f1) {
      if ((1 << f1) & bits) continue;
      for (var f2 = f1 + 1; f2 < 12; ++f2) {
        if ((1 << f2) & bits) continue;
        for (var f3 = f2 + 1; f3 < 13; ++f3) {
          if ((1 << f3) & bits) continue;

          this.front = new WaveEvaluator(
            [this.hand[f1], this.hand[f2], this.hand[f3]], Front);
          if (this.center.is_smaller_than(this.front)) break out;

          var sum_value = this.front.value + this.center.value + this.back.value;
          if (this.max_value < sum_value) {
            this.max_value = sum_value;
            this.max_waves = [].concat(this.front.wave, this.center.wave,
                                       this.back.wave);
          }
        }
      }
    }
  }

  get waves() {
    return this.max_waves;
  }
};

function optimize_hand() {
  var max_waves = (new HandOptimizer(hand)).waves;
  waves['front'] = max_waves.slice(0, 3);
  waves['center'] = max_waves.slice(3, 8);
  waves['back'] = max_waves.slice(8, 13);
  for (var name in waves) {
    for (var index in waves[name]) {
      membership[waves[name][index]] = name;
    }
    redraw_wave(name);
  }
  redraw_hand();
}
    </script>
  </head>
  <body onload='deal_hand()'>
    <h1>十三水•Chinese Poker</h1>
    <hr/>
    <h2 id='ai_score'>AI: 0</h2>
    <table>
      <tr>
        <td>
          <table class='hand' id='ai_front'>
            <tr>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_front_rank_0'>?</td></tr>
                  <tr><td class='suit' id='ai_front_suit_0'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_front_rank_1'>?</td></tr>
                  <tr><td class='suit' id='ai_front_suit_1'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_front_rank_2'>?</td></tr>
                  <tr><td class='suit' id='ai_front_suit_2'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <table class='hand' id='ai_center'>
            <tr>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_center_rank_0'>?</td></tr>
                  <tr><td class='suit' id='ai_center_suit_0'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_center_rank_1'>?</td></tr>
                  <tr><td class='suit' id='ai_center_suit_1'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_center_rank_2'>?</td></tr>
                  <tr><td class='suit' id='ai_center_suit_2'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_center_rank_3'>?</td></tr>
                  <tr><td class='suit' id='ai_center_suit_3'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_center_rank_4'>?</td></tr>
                  <tr><td class='suit' id='ai_center_suit_4'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <table class='hand' id='ai_back'>
            <tr>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_back_rank_0'>?</td></tr>
                  <tr><td class='suit' id='ai_back_suit_0'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_back_rank_1'>?</td></tr>
                  <tr><td class='suit' id='ai_back_suit_1'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_back_rank_2'>?</td></tr>
                  <tr><td class='suit' id='ai_back_suit_2'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_back_rank_3'>?</td></tr>
                  <tr><td class='suit' id='ai_back_suit_3'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card'>
                  <tr><td class='rank' id='ai_back_rank_4'>?</td></tr>
                  <tr><td class='suit' id='ai_back_suit_4'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <hr/>

    <table>
      <tr>
        <td>
          <h2 id='score'>You: 0</h2>
        </td>
        <td>
          &nbsp; &nbsp; &nbsp; &nbsp;
          <button class='menu' id='deal' onclick='deal_hand()'>Deal hand</button>
          <button class='menu' id='show' onclick='show_hand()'>Show hand</button>
        </td>
        <td>
          &nbsp; &nbsp; &nbsp; &nbsp;
          <button class='menu' onclick='optimize_hand()'>Optimize</button>
        </td>
        <td>
          &nbsp; &nbsp; &nbsp; &nbsp;
          <button class='menu' onclick='save_waves()'>Save</button>
        </td>
        <td class='menu' id='load'>
          &nbsp; &nbsp;
          Load:
        </td>
        <td id='load_area'>
        </td>
      </tr>
    </table>

    <table>
      <tr>
        <td class='pattern' id='front_pattern'>&nbsp;</td>
        <td class='pattern' id='center_pattern'>&nbsp;</td>
        <td class='pattern' id='back_pattern'>&nbsp;</td>
        <td class='pattern' id='average'>&nbsp;</td>
      </tr>
      <tr>
        <td>
          <table class='hand' id='front'>
            <tr>
              <td>
                <table class='card' onclick='undo_card("front", 0)'>
                  <tr><td class='rank' id='front_rank_0'>?</td></tr>
                  <tr><td class='suit' id='front_suit_0'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("front", 1)'>
                  <tr><td class='rank' id='front_rank_1'>?</td></tr>
                  <tr><td class='suit' id='front_suit_1'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("front", 2)'>
                  <tr><td class='rank' id='front_rank_2'>?</td></tr>
                  <tr><td class='suit' id='front_suit_2'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <table class='hand' id='center'>
            <tr>
              <td>
                <table class='card' onclick='undo_card("center", 0)'>
                  <tr><td class='rank' id='center_rank_0'>?</td></tr>
                  <tr><td class='suit' id='center_suit_0'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("center", 1)'>
                  <tr><td class='rank' id='center_rank_1'>?</td></tr>
                  <tr><td class='suit' id='center_suit_1'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("center", 2)'>
                  <tr><td class='rank' id='center_rank_2'>?</td></tr>
                  <tr><td class='suit' id='center_suit_2'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("center", 3)'>
                  <tr><td class='rank' id='center_rank_3'>?</td></tr>
                  <tr><td class='suit' id='center_suit_3'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("center", 4)'>
                  <tr><td class='rank' id='center_rank_4'>?</td></tr>
                  <tr><td class='suit' id='center_suit_4'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <table class='hand' id='back'>
            <tr>
              <td>
                <table class='card' onclick='undo_card("back", 0)'>
                  <tr><td class='rank' id='back_rank_0'>?</td></tr>
                  <tr><td class='suit' id='back_suit_0'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("back", 1)'>
                  <tr><td class='rank' id='back_rank_1'>?</td></tr>
                  <tr><td class='suit' id='back_suit_1'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("back", 2)'>
                  <tr><td class='rank' id='back_rank_2'>?</td></tr>
                  <tr><td class='suit' id='back_suit_2'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("back", 3)'>
                  <tr><td class='rank' id='back_rank_3'>?</td></tr>
                  <tr><td class='suit' id='back_suit_3'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' onclick='undo_card("back", 4)'>
                  <tr><td class='rank' id='back_rank_4'>?</td></tr>
                  <tr><td class='suit' id='back_suit_4'>?</td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <button class='menu' onclick='undo_all_cards()'>Clear all</button>
        </td>
      </tr>
      <tr>
        <td class='move'>
          <button class='move' onclick='fill_wave("front")'>⇈</button>
          &nbsp; &nbsp;
          <button class='move' onclick='clear_wave("front")'>⇊</button>
        </td>
        <td class='move'>
          <button class='move' onclick='fill_wave("center")'>⇈</button>
          &nbsp; &nbsp;
          <button class='move' onclick='clear_wave("center")'>⇊</button>
        </td>
        <td class='move'>
          <button class='move' onclick='fill_wave("back")'>⇈</button>
          &nbsp; &nbsp;
          <button class='move' onclick='clear_wave("back")'>⇊</button>
        </td>
      </tr>
    </table>

    <table>
      <tr>
        <td>
          <table class='hand'>
            <tr>
              <td>
                <table class='card' id='card_0' onclick='move_card(0)'>
                  <tr><td class='rank' id='rank_0'></td></tr>
                  <tr><td class='suit' id='suit_0'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_1' onclick='move_card(1)'>
                  <tr><td class='rank' id='rank_1'></td></tr>
                  <tr><td class='suit' id='suit_1'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_2' onclick='move_card(2)'>
                  <tr><td class='rank' id='rank_2'></td></tr>
                  <tr><td class='suit' id='suit_2'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_3' onclick='move_card(3)'>
                  <tr><td class='rank' id='rank_3'></td></tr>
                  <tr><td class='suit' id='suit_3'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_4' onclick='move_card(4)'>
                  <tr><td class='rank' id='rank_4'></td></tr>
                  <tr><td class='suit' id='suit_4'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_5' onclick='move_card(5)'>
                  <tr><td class='rank' id='rank_5'></td></tr>
                  <tr><td class='suit' id='suit_5'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_6' onclick='move_card(6)'>
                  <tr><td class='rank' id='rank_6'></td></tr>
                  <tr><td class='suit' id='suit_6'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_7' onclick='move_card(7)'>
                  <tr><td class='rank' id='rank_7'></td></tr>
                  <tr><td class='suit' id='suit_7'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_8' onclick='move_card(8)'>
                  <tr><td class='rank' id='rank_8'></td></tr>
                  <tr><td class='suit' id='suit_8'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_9' onclick='move_card(9)'>
                  <tr><td class='rank' id='rank_9'></td></tr>
                  <tr><td class='suit' id='suit_9'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_10' onclick='move_card(10)'>
                  <tr><td class='rank' id='rank_10'></td></tr>
                  <tr><td class='suit' id='suit_10'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_11' onclick='move_card(11)'>
                  <tr><td class='rank' id='rank_11'></td></tr>
                  <tr><td class='suit' id='suit_11'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
              <td>
                <table class='card' id='card_12' onclick='move_card(12)'>
                  <tr><td class='rank' id='rank_12'></td></tr>
                  <tr><td class='suit' id='suit_12'></td></tr>
                  <tr><td></td></tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
        <td>
          <button class='menu' id='sort' onclick='sort_hand()'></button>
        </td>
      </tr>
    </table>
    <hr/>
  </body>
</html>
